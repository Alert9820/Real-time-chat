<!-- private-chat.html -->
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Private Chat</title>
<script src="https://cdn.socket.io/4.7.1/socket.io.min.js"></script>
<style>
  #chat { border: 1px solid #ccc; height: 300px; overflow-y: scroll; padding: 10px; }
  #typing { font-style: italic; color: gray; }
</style>
</head>
<body>
<h2>Private Chat Room</h2>
<div id="chat"></div>
<div id="typing"></div>
<input id="msg" type="text" placeholder="Type message..." autocomplete="off"/>
<button id="send">Send</button>

<script>
const socket = io("http://localhost:5000");

// ðŸ’¾ User info
const uid = prompt("Enter your UID");
const name = prompt("Enter your Name");
const room = prompt("Enter Room ID");

// Set name on server
socket.emit("set_name", { uid, name });

// Join room
socket.emit("join-room", room);

// Typing event
const input = document.getElementById("msg");
input.addEventListener("input", () => {
  socket.emit("typing", { room, name });
});

// Display typing indicator
socket.on("typing", (who) => {
  const t = document.getElementById("typing");
  t.innerText = who + " is typing...";
  setTimeout(() => { t.innerText = ""; }, 1000);
});

// Display messages
const chatDiv = document.getElementById("chat");
function appendMessage(sender, text) {
  const div = document.createElement("div");
  div.innerHTML = `<b>${sender}:</b> ${text}`;
  chatDiv.appendChild(div);
  chatDiv.scrollTop = chatDiv.scrollHeight;
}

// Receive private messages
socket.on("private-message", (msg) => appendMessage(msg.sender, msg.text));

// Receive bot replies
socket.on("bot-reply", (msg) => appendMessage(msg.sender, msg.text));

// Send message
document.getElementById("send").addEventListener("click", () => {
  const text = input.value.trim();
  if(!text) return;
  socket.emit("private-message", { room, sender: name, text });
  appendMessage(name, text);
  input.value = "";
});

// Load previous messages from server
fetch(`http://localhost:5000/get-room-messages?room=${room}`)
.then(res => res.json())
.then(data => {
  data.forEach(msg => appendMessage(msg.sender, msg.text));
});
</script>
</body>
</html>
