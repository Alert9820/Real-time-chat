<!-- âœ… BotX Private Chat with Friend-Based Messaging --><!-- ðŸŽ¯ No Room System, Pure Friend UID-Based Chat, Data Persist in localStorage --><!DOCTYPE html><html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Private Chat - BotX</title>
  <script src="https://cdn.socket.io/4.0.1/socket.io.min.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Poppins&display=swap" rel="stylesheet" />
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: 'Poppins', sans-serif;
      background: #111;
      color: #fff;
      height: 100vh;
      display: flex;
      flex-direction: column;
    }
    .topbar {
      background: #1c1c1c;
      padding: 15px 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .toggle {
      font-size: 24px;
      color: #6cf;
      cursor: pointer;
    }
    .sidebar {
      width: 230px;
      background: #121212;
      position: fixed;
      top: 0;
      left: 0;
      height: 100%;
      padding: 20px;
      transform: translateX(-100%);
      transition: transform 0.3s ease;
      z-index: 10;
    }
    .sidebar.active { transform: translateX(0); }
    .sidebar .close-btn {
      font-size: 22px;
      color: #f66;
      text-align: right;
      cursor: pointer;
    }
    .sidebar a {
      display: block;
      margin: 15px 0;
      text-decoration: none;
      color: #6cf;
      font-weight: bold;
    }
    .friend-list {
      padding: 20px;
      overflow-y: auto;
      flex: 1;
    }
    .friend-item {
      padding: 10px;
      background: #222;
      margin-bottom: 10px;
      border-radius: 10px;
      cursor: pointer;
    }
    .friend-item:hover { background: #333; }
    .chat-container {
      display: none;
      flex-direction: column;
      height: 100%;
    }
    .chat-box {
      flex: 1;
      padding: 15px;
      overflow-y: auto;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }
    .message {
      padding: 10px;
      border-radius: 12px;
      max-width: 70%;
      word-wrap: break-word;
      position: relative;
    }
    .me { align-self: flex-end; background: #6cf; color: #000; }
    .other { align-self: flex-start; background: #333; }
    .input-area {
      display: flex;
      gap: 8px;
      padding: 10px;
      background: #1c1c1c;
    }
    input[type="text"] {
      flex: 1;
      background: #222;
      border: none;
      padding: 10px;
      color: #fff;
      border-radius: 10px;
    }
    button {
      padding: 10px;
      background: #6cf;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      font-weight: bold;
      color: #000;
    }
  </style>
</head>
<body><div class="topbar">
  <div class="toggle" onclick="toggleSidebar()">â˜°</div>
  <h3>Private Chat</h3>
  <span id="activeFriend"></span>
</div><div class="sidebar" id="sidebar">
  <div class="close-btn" onclick="toggleSidebar()">Ã—</div>
  <a href="dashboard.html">Dashboard</a>
  <a href="home.html">Bot Assistant</a>
  <a href="chatroom.html">Chat Room</a>
  <a href="privatechat.html">Private Chat</a>
  <a href="history.html">Bot History</a>
  <a href="friends.html">Friends</a>
  <a href="login.html" onclick="localStorage.clear()">Logout</a>
</div><!-- Friend List --><div class="friend-list" id="friendList"></div><!-- Chat UI --><div class="chat-container" id="chatUI">
  <div class="chat-box" id="chatBox"></div>
  <div class="input-area">
    <input type="text" id="messageInput" placeholder="Type a message..." />
    <button onclick="sendMessage()">Send</button>
  </div>
</div><script>
const userData = JSON.parse(localStorage.getItem("user") || "{}");
const name = userData.name || "User";
const friends = userData.friends || [];

let activeUID = null;
let messages = {};

function toggleSidebar() {
  document.getElementById("sidebar").classList.toggle("active");
}

function loadMessages(uid) {
  const raw = localStorage.getItem("chat-" + uid);
  return raw ? JSON.parse(raw) : [];
}

function saveMessages(uid, msgs) {
  localStorage.setItem("chat-" + uid, JSON.stringify(msgs));
}

function openChat(uid, friendName) {
  activeUID = uid;
  messages[uid] = loadMessages(uid);
  document.getElementById("chatBox").innerHTML = "";
  document.getElementById("chatUI").style.display = "flex";
  document.getElementById("friendList").style.display = "none";
  document.getElementById("activeFriend").innerText = friendName;
  messages[uid].forEach(m => appendMessage(m.sender, m.text));
}

function appendMessage(sender, text) {
  const div = document.createElement("div");
  div.className = "message " + (sender === name ? "me" : "other");
  div.innerHTML = `<b>${sender}:</b> ${text}`;
  document.getElementById("chatBox").appendChild(div);
  document.getElementById("chatBox").scrollTop = chatBox.scrollHeight;
}

function sendMessage() {
  const input = document.getElementById("messageInput");
  const text = input.value.trim();
  if (!text || !activeUID) return;
  appendMessage(name, text);
  messages[activeUID].push({ sender: name, text });
  saveMessages(activeUID, messages[activeUID]);
  input.value = "";
}

// Load Friend List
const listDiv = document.getElementById("friendList");
if (Array.isArray(friends) && friends.length) {
  friends.forEach(f => {
    const item = document.createElement("div");
    item.className = "friend-item";
    item.innerText = f.name;
    item.onclick = () => openChat(f.uid, f.name);
    listDiv.appendChild(item);
  });
} else {
  listDiv.innerHTML = "<p style='padding:20px;'>No friends found.</p>";
}
</script></body>
    </html>
